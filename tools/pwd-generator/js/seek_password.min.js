function hex_password(pwd,key){var hexone=sha512.hmac(key,pwd),hextwo=sha512.hmac("hello",hexone),hexthree=sha512.hmac("world",hexone),source=hextwo.split(""),rule=hexthree.split("");console.assert(rule.length===source.length,"sha512长度错误！");for(var i=0;i<source.length;++i){var str;if(isNaN(source[i]))"whenthecatisawaythemicewillplay".search(rule[i])>-1&&(source[i]=source[i].toUpperCase())}return source.join("")}function seek_password(hash,length,rule_of_punctuation,rule_of_letter){var lower="abcdefghijklmnopqrstuvwxyz".split(""),upper="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),number="0123456789".split(""),punctuation=",.:;!?".split(""),alphabet=lower.concat(number);1==parseInt(rule_of_punctuation)&&(alphabet=alphabet.concat(punctuation)),1==parseInt(rule_of_letter)&&(alphabet=alphabet.concat(upper));for(var i=0;i<=hash.length-length;++i){var sub_hash=hash.slice(i,i+parseInt(length)).split(""),count=0,map_index,sk_pwd=sub_hash.map(function(c){return count=(count+c.charCodeAt())%alphabet.length}).map(function(k){return alphabet[k]}),matched=[!1,!1,!1,!1];if(sk_pwd.forEach(function(e){matched[0]=matched[0]||lower.includes(e),matched[1]=matched[1]||upper.includes(e),matched[2]=matched[2]||number.includes(e),matched[3]=matched[3]||punctuation.includes(e)}),-1==parseInt(rule_of_letter)&&(matched[1]=!0),-1==parseInt(rule_of_punctuation)&&(matched[3]=!0),!matched.includes(!1))return sk_pwd.join("")}return""}function get_select_option(select_id){var select=document.getElementById(select_id),select_index=select.selectedIndex;return[select.options[select_index].value,select.options[select_index].text]}function generate_password(){var pwd=document.getElementById("pwd").value,key=document.getElementById("key").value,rule_of_punctuation=get_select_option("rule_of_punctuation"),rule_of_letter=get_select_option("rule_of_letter"),pwd_length=get_select_option("pwd_length");if(pwd&&key){var hash=hex_password(pwd,key),sk_pwd;return console.assert(128===hash.length,"hash长度不是128位！"),seek_password(hash,pwd_length[0],rule_of_punctuation[0],rule_of_letter[0])}}